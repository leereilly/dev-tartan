<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev Tartan — GitHub Username Tartan Generator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Crimson+Text:ital@0;1&display=swap');

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      background: #f4edd3;
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(139,119,75,0.03) 50px, rgba(139,119,75,0.03) 51px),
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(139,119,75,0.03) 50px, rgba(139,119,75,0.03) 51px);
      font-family: 'Crimson Text', 'Georgia', serif;
      color: #2c1810;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    header h1 {
      font-family: 'Playfair Display', 'Georgia', serif;
      font-size: 2.8rem;
      font-weight: 700;
      color: #1a0f08;
      letter-spacing: 0.04em;
      margin-bottom: 0.25rem;
    }

    header h1 .accent {
      color: #8b2500;
    }

    header p.subtitle {
      font-size: 1.15rem;
      font-style: italic;
      color: #6b5240;
      margin-top: 0.25rem;
    }

    .divider {
      width: 200px;
      height: 2px;
      background: linear-gradient(90deg, transparent, #8b774b, transparent);
      margin: 0.75rem auto;
    }

    .input-section {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .input-section label {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      color: #3d2b1f;
    }

    .input-section input[type="text"] {
      font-family: 'Crimson Text', serif;
      font-size: 1.15rem;
      padding: 0.5rem 1rem;
      border: 2px solid #8b774b;
      border-radius: 4px;
      background: #faf6e9;
      color: #2c1810;
      width: 260px;
      outline: none;
      transition: border-color 0.2s;
    }

    .input-section input[type="text"]:focus {
      border-color: #8b2500;
    }

    .input-section input[type="text"]::placeholder {
      color: #b5a78a;
      font-style: italic;
    }

    button {
      font-family: 'Playfair Display', serif;
      font-size: 1rem;
      padding: 0.55rem 1.5rem;
      border: 2px solid #8b774b;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    button.generate-btn {
      background: #8b2500;
      color: #f4edd3;
      border-color: #6b1c00;
    }

    button.generate-btn:hover {
      background: #a52d00;
    }

    button.download-btn {
      background: #2c5234;
      color: #f4edd3;
      border-color: #1a3320;
      display: none;
    }

    button.download-btn:hover {
      background: #3a6b45;
    }

    .tartan-container {
      position: relative;
      margin-bottom: 1.5rem;
    }

    #tartan-display {
      border: 4px solid #8b774b;
      border-radius: 4px;
      box-shadow: 0 4px 20px rgba(44,24,16,0.15);
      background: #faf6e9;
      display: none;
    }

    .sett-display {
      display: none;
      margin-top: 1rem;
      text-align: center;
    }

    .sett-display h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: #3d2b1f;
    }

    .sett-colors {
      display: flex;
      gap: 4px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .sett-color {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .sett-swatch {
      width: 32px;
      height: 32px;
      border: 1px solid #8b774b;
      border-radius: 3px;
    }

    .sett-label {
      font-size: 0.7rem;
      color: #6b5240;
      font-family: monospace;
    }

    .sett-thread-count {
      font-size: 0.95rem;
      color: #6b5240;
      font-style: italic;
    }

    .username-label {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem;
      color: #3d2b1f;
      margin-bottom: 0.5rem;
      display: none;
      text-align: center;
    }

    .username-label span {
      color: #8b2500;
      font-weight: 700;
    }

    footer {
      margin-top: auto;
      padding-top: 2rem;
      text-align: center;
      color: #8b774b;
      font-size: 0.9rem;
      font-style: italic;
    }

    @media (max-width: 600px) {
      header h1 { font-size: 2rem; }
      .input-section input[type="text"] { width: 200px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Dev <span class="accent">Tartan</span></h1>
    <div class="divider"></div>
    <p class="subtitle">Every developer deserves their own clan</p>
  </header>

  <form class="input-section" id="tartan-form">
    <label for="username">GitHub Username:</label>
    <input type="text" id="username" placeholder="e.g. octocat" autocomplete="off" required>
    <button type="submit" class="generate-btn">Weave Tartan</button>
    <button type="button" class="download-btn" id="download-btn">Download SVG</button>
  </form>

  <div class="username-label" id="username-label">The tartan of <span id="display-name"></span></div>

  <div class="tartan-container">
    <svg id="tartan-display" width="500" height="500" xmlns="http://www.w3.org/2000/svg"></svg>
  </div>

  <div class="sett-display" id="sett-display">
    <h3>Thread Count</h3>
    <div class="sett-colors" id="sett-colors"></div>
    <div class="sett-thread-count" id="sett-thread-count"></div>
  </div>

  <footer>
    <p>Woven with bits &amp; bytes &bull; SHA-256 &rarr; Sett</p>
  </footer>

  <script>
    // Traditional tartan colour palette — authentic Scottish dye colours
    const TARTAN_PALETTE = [
      { name: 'Dark Navy',      hex: '#1c2541' },
      { name: 'Royal Blue',     hex: '#2b4c7e' },
      { name: 'Azure',          hex: '#3a7ca5' },
      { name: 'Sky Blue',       hex: '#6fb3d2' },
      { name: 'Hunter Green',   hex: '#1a472a' },
      { name: 'Forest Green',   hex: '#2d5a27' },
      { name: 'Moss Green',     hex: '#4a7c59' },
      { name: 'Sage',           hex: '#87a96b' },
      { name: 'Crimson',        hex: '#8b1a1a' },
      { name: 'Scarlet',        hex: '#c41e3a' },
      { name: 'Rust',           hex: '#a0522d' },
      { name: 'Burnt Orange',   hex: '#c76f30' },
      { name: 'Gold',           hex: '#c5a041' },
      { name: 'Straw',          hex: '#d4b94e' },
      { name: 'Purple',         hex: '#5b2c6f' },
      { name: 'Heather',        hex: '#7d5a9e' },
      { name: 'Black',          hex: '#1a1a1a' },
      { name: 'Charcoal',       hex: '#3d3d3d' },
      { name: 'Grey',           hex: '#7a7a7a' },
      { name: 'Ivory',          hex: '#f0e8d0' },
    ];

    // Hash a string to SHA-256 and return byte array
    async function sha256(str) {
      const data = new TextEncoder().encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      return new Uint8Array(hashBuffer);
    }

    // Derive a tartan sett (colour+width sequence) from hash bytes
    function deriveSett(hashBytes) {
      // Determine number of colours: 4-6, from first byte
      const numColors = 4 + (hashBytes[0] % 3); // 4, 5, or 6

      // Pick colours from palette using hash bytes
      const colors = [];
      for (let i = 0; i < numColors; i++) {
        const idx = hashBytes[1 + i] % TARTAN_PALETTE.length;
        const color = TARTAN_PALETTE[idx];
        // Avoid duplicate colours
        if (!colors.find(c => c.hex === color.hex)) {
          colors.push(color);
        } else {
          // Pick next available
          const altIdx = (idx + 7) % TARTAN_PALETTE.length;
          colors.push(TARTAN_PALETTE[altIdx]);
        }
      }

      // Derive thread counts (widths) from subsequent hash bytes
      // Traditional tartans have varying stripe widths: thin (2-6), medium (8-16), wide (18-36)
      const threadCounts = [];
      for (let i = 0; i < colors.length; i++) {
        const byte = hashBytes[8 + i];
        // Map byte to a thread count: bias toward variety
        let count;
        if (byte < 64) {
          count = 2 + (byte % 5);       // thin: 2-6
        } else if (byte < 180) {
          count = 8 + (byte % 9);        // medium: 8-16
        } else {
          count = 18 + (byte % 19);      // wide: 18-36
        }
        threadCounts.push(count);
      }

      // Build the sett: sequence of { color, width }
      const sett = colors.map((c, i) => ({
        color: c,
        width: threadCounts[i]
      }));

      return sett;
    }

    // Create the full symmetric stripe sequence from a sett
    // Traditional tartans reflect: A B C D C B A B C D C B A ...
    function expandSett(sett) {
      if (sett.length <= 1) return sett;
      // pivot: full sett forward, then reverse without first and last (mirror)
      const forward = [...sett];
      const reverse = [...sett].slice(1, -1).reverse();
      return [...forward, ...reverse];
    }

    // Render the tartan SVG
    function renderTartan(svg, sett, size = 500) {
      svg.innerHTML = '';
      svg.setAttribute('width', size);
      svg.setAttribute('height', size);
      svg.setAttribute('viewBox', `0 0 ${size} ${size}`);

      const symmetricSett = expandSett(sett);

      // Calculate total width of one repeat
      const repeatWidth = symmetricSett.reduce((sum, s) => sum + s.width, 0);
      if (repeatWidth === 0) return;

      // Scale factor to fill the SVG nicely (aim for ~3-4 repeats)
      const targetRepeats = 3;
      const scale = size / (repeatWidth * targetRepeats);

      // Create defs for the pattern
      const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');

      // Background
      const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      bg.setAttribute('width', size);
      bg.setAttribute('height', size);
      bg.setAttribute('fill', sett[0].color.hex);
      svg.appendChild(bg);

      // Draw warp (vertical stripes) with reduced opacity
      const warpGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      warpGroup.setAttribute('opacity', '0.9');
      let x = 0;
      while (x < size) {
        for (const stripe of symmetricSett) {
          const w = stripe.width * scale;
          if (x + w > size + w) break;
          const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          rect.setAttribute('x', x);
          rect.setAttribute('y', 0);
          rect.setAttribute('width', Math.ceil(w));
          rect.setAttribute('height', size);
          rect.setAttribute('fill', stripe.color.hex);
          warpGroup.appendChild(rect);
          x += w;
        }
      }
      svg.appendChild(warpGroup);

      // Draw weft (horizontal stripes) with transparency for woven effect
      const weftGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      weftGroup.setAttribute('opacity', '0.55');
      weftGroup.setAttribute('style', 'mix-blend-mode: multiply;');
      let y = 0;
      while (y < size) {
        for (const stripe of symmetricSett) {
          const h = stripe.width * scale;
          if (y + h > size + h) break;
          const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          rect.setAttribute('x', 0);
          rect.setAttribute('y', y);
          rect.setAttribute('width', size);
          rect.setAttribute('height', Math.ceil(h));
          rect.setAttribute('fill', stripe.color.hex);
          weftGroup.appendChild(rect);
          y += h;
        }
      }
      svg.appendChild(weftGroup);

      // Add subtle twill texture overlay for authenticity
      const twillPattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
      twillPattern.setAttribute('id', 'twill');
      twillPattern.setAttribute('width', '4');
      twillPattern.setAttribute('height', '4');
      twillPattern.setAttribute('patternUnits', 'userSpaceOnUse');

      const twillLine1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      twillLine1.setAttribute('x', '0'); twillLine1.setAttribute('y', '0');
      twillLine1.setAttribute('width', '2'); twillLine1.setAttribute('height', '2');
      twillLine1.setAttribute('fill', 'rgba(255,255,255,0.04)');
      twillPattern.appendChild(twillLine1);

      const twillLine2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      twillLine2.setAttribute('x', '2'); twillLine2.setAttribute('y', '2');
      twillLine2.setAttribute('width', '2'); twillLine2.setAttribute('height', '2');
      twillLine2.setAttribute('fill', 'rgba(0,0,0,0.04)');
      twillPattern.appendChild(twillLine2);

      defs.appendChild(twillPattern);
      svg.insertBefore(defs, svg.firstChild);

      const twillOverlay = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      twillOverlay.setAttribute('width', size);
      twillOverlay.setAttribute('height', size);
      twillOverlay.setAttribute('fill', 'url(#twill)');
      svg.appendChild(twillOverlay);
    }

    // Display the sett information
    function displaySett(sett) {
      const colorsDiv = document.getElementById('sett-colors');
      const threadCountDiv = document.getElementById('sett-thread-count');
      colorsDiv.innerHTML = '';

      const threadParts = [];
      sett.forEach(s => {
        const swatch = document.createElement('div');
        swatch.className = 'sett-color';
        swatch.innerHTML = `
          <div class="sett-swatch" style="background:${s.color.hex}"></div>
          <span class="sett-label">${s.color.name}</span>
        `;
        colorsDiv.appendChild(swatch);

        // Thread count abbreviation: first letter of colour name + count
        const abbr = s.color.name.split(' ').map(w => w[0]).join('');
        threadParts.push(`${abbr}/${s.width}`);
      });

      threadCountDiv.textContent = threadParts.join('  ');
      document.getElementById('sett-display').style.display = 'block';
    }

    // Download SVG
    function downloadSVG() {
      const svg = document.getElementById('tartan-display');
      const serializer = new XMLSerializer();
      let source = serializer.serializeToString(svg);

      // Add XML declaration and namespace
      if (!source.includes('xmlns=')) {
        source = source.replace('<svg', '<svg xmlns="http://www.w3.org/2000/svg"');
      }
      source = '<?xml version="1.0" encoding="UTF-8"?>\n' + source;

      const blob = new Blob([source], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const username = document.getElementById('username').value.trim();
      a.href = url;
      a.download = `${username}-tartan.svg`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Main generate handler
    async function generateTartan(username) {
      const hashBytes = await sha256(username.toLowerCase());
      const sett = deriveSett(hashBytes);

      const svg = document.getElementById('tartan-display');
      renderTartan(svg, sett);

      svg.style.display = 'block';
      document.getElementById('download-btn').style.display = 'inline-block';
      document.getElementById('username-label').style.display = 'block';
      document.getElementById('display-name').textContent = username;

      displaySett(sett);
    }

    // Event listeners
    document.getElementById('tartan-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim().replace(/^@/, '');
      if (username) generateTartan(username);
    });

    document.getElementById('download-btn').addEventListener('click', downloadSVG);

    // Generate on URL hash
    if (window.location.hash) {
      const username = decodeURIComponent(window.location.hash.slice(1)).replace(/^@/, '');
      if (username) {
        document.getElementById('username').value = username;
        generateTartan(username);
      }
    }
  </script>
</body>
</html>
